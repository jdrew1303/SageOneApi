<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<OutputType>Library</OutputType>
		<EmbedAllSources>true</EmbedAllSources>
		<DebugType>embedded</DebugType>
		<Authors>Ledgerscope</Authors>
		<Company>Ledgerscope</Company>
		<Product />
		<Description>Wrapper for Sage Business Cloud Accounting API</Description>
		<GeneratePackageOnBuild>true</GeneratePackageOnBuild>
		<PackageVersion>$(PackageVersion)</PackageVersion>
	</PropertyGroup>

	<ItemGroup>
		<None Remove="TestHelpers\SampleFiles\SalesInvoices.json" />
	</ItemGroup>

	<ItemGroup>
		<EmbeddedResource Include="TestHelpers\SampleFiles\SalesInvoices.json" />
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="Microsoft.CodeAnalysis.Compilers" Version="4.0.0-4.final" />
		<PackageReference Include="Microsoft.Net.Compilers" Version="4.0.0-4.final">
			<PrivateAssets>all</PrivateAssets>
			<IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
		</PackageReference>
		<PackageReference Include="System.Text.Json" Version="6.0.0-rc.1.21451.13" />
	</ItemGroup>

	<!--	When compiled in Debug mode, nest the tests.cs classes, and include the packages needed
		for unit testing and code analysis; remove them for Release.  -->
	<Choose>
		<When Condition="'$(Configuration)' == 'Debug'">
			<PropertyGroup>
				<TargetFrameworks>netstandard2.0;netcoreapp3.1</TargetFrameworks>
				<AnalysisLevel>latest</AnalysisLevel>
			</PropertyGroup>
			<ItemGroup>
				<Compile Update="**\?*.tests*.cs">
					<DependentUpon>$([System.Text.RegularExpressions.Regex]::Match(%(Filename), `^.*(?=\.tests.*)`)).cs</DependentUpon>
					<SubType>Code</SubType>
				</Compile>
				<!-- Microsoft.NET.Test.Sdk added to get a test-tube project icon when in Debug mode, to signify it is a with-integrated-tests project. -->
				<PackageReference Include="Microsoft.NET.Test.Sdk" Version="16.11.0" />
				<PackageReference Include="MSTest.TestAdapter" Version="2.2.7">
				  <TreatAsUsed>true</TreatAsUsed>
				</PackageReference>
				<PackageReference Include="MSTest.TestFramework" Version="2.2.7" />
				<PackageReference Include="Microsoft.CodeAnalysis.NetAnalyzers" Version="5.0.3">
					<PrivateAssets>all</PrivateAssets>
					<IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
				</PackageReference>
			</ItemGroup>
		</When>
		<Otherwise>
			<PropertyGroup>
				<TargetFrameworks>netstandard2.0</TargetFrameworks>
				<AnalysisLevel>latest</AnalysisLevel>
			</PropertyGroup>
			<ItemGroup>
				<Compile Remove="**\?*.tests*.cs" />
			</ItemGroup>
		</Otherwise>
	</Choose>

</Project>
